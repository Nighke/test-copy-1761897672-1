Ly8gRW5oYW5jZWQgc2l0ZSBmdW5jdGlvbmFsaXR5CmRvY3VtZW50LmFkZEV2
ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbigpIHsK
ICAgIGNvbnNvbGUubG9nKCfwn5qAIFNpdGUgbG9hZGVkIHN1Y2Nlc3NmdWxs
eSEnKTsKICAgIAogICAgLy8gSW5pdGlhbGl6ZSBzaXRlIGZlYXR1cmVzCiAg
ICBpbml0QW5pbWF0aW9ucygpOwogICAgaW5pdEludGVyYWN0aW9uKCk7CiAg
ICBpbml0U3RhdHVzKCk7CiAgICAKICAgIC8vIENoZWNrIGVudmlyb25tZW50
CiAgICBjaGVja0Vudmlyb25tZW50KCk7Cn0pOwoKLyogSW5pdGlhbGl6ZSBh
bmltYXRpb25zICovCmZ1bmN0aW9uIGluaXRBbmltYXRpb25zKCkgewogICAg
Y29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNv
bnRhaW5lcicpOwogICAgCiAgICAvLyBBZGQgZW50cmFuY2UgYW5pbWF0aW9u
CiAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICBjb250YWluZXIuc3R5
bGUub3BhY2l0eSA9ICcxJzsKICAgICAgICBjb250YWluZXIuc3R5bGUudHJh
bnNmb3JtID0gJ3NjYWxlKDEpJzsKICAgIH0sIDEwMCk7CiAgICAKICAgIC8v
IEhvdmVyIGVmZmVjdHMKICAgIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVy
KCdtb3VzZWVudGVyJywgZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5zdHls
ZS50cmFuc2Zvcm0gPSAndHJhbnNsYXRlWSgtNXB4KSBzY2FsZSgxLjAyKSc7
CiAgICAgICAgdGhpcy5zdHlsZS50cmFuc2l0aW9uID0gJ2FsbCAwLjNzIGN1
YmljLWJlemllcigwLjQsIDAsIDAuMiwgMSknOwogICAgfSk7CiAgICAKICAg
IGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgZnVu
Y3Rpb24oKSB7CiAgICAgICAgdGhpcy5zdHlsZS50cmFuc2Zvcm0gPSAndHJh
bnNsYXRlWSgwKSBzY2FsZSgxKSc7CiAgICB9KTsKfQoKLyogSW5pdGlhbGl6
ZSBpbnRlcmFjdGl2ZSBlbGVtZW50cyAqLwpmdW5jdGlvbiBpbml0SW50ZXJh
Y3Rpb24oKSB7CiAgICAvLyBBZGQgY2xpY2sgYW5pbWF0aW9uIHRvIHN0YXR1
cwogICAgY29uc3Qgc3RhdHVzRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1l
bnRCeUlkKCdzdGF0dXMnKTsKICAgIGlmIChzdGF0dXNFbGVtZW50KSB7CiAg
ICAgICAgc3RhdHVzRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycs
IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB0aGlzLnN0eWxlLnRyYW5zZm9y
bSA9ICdzY2FsZSgwLjk1KSc7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkg
PT4gewogICAgICAgICAgICAgICAgdGhpcy5zdHlsZS50cmFuc2Zvcm0gPSAn
c2NhbGUoMSknOwogICAgICAgICAgICB9LCAxNTApOwogICAgICAgIH0pOwog
ICAgfQogICAgCiAgICAvLyBBZGQgc21vb3RoIHNjcm9sbGluZyBmb3IgYW55
IGxpbmtzCiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdhW2hyZWZe
PSIjIl0nKS5mb3JFYWNoKGFuY2hvciA9PiB7CiAgICAgICAgYW5jaG9yLmFk
ZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHsKICAgICAg
ICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBjb25zdCB0
YXJnZXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuZ2V0QXR0cmli
dXRlKCdocmVmJykpOwogICAgICAgICAgICBpZiAodGFyZ2V0KSB7CiAgICAg
ICAgICAgICAgICB0YXJnZXQuc2Nyb2xsSW50b1ZpZXcoewogICAgICAgICAg
ICAgICAgICAgIGJlaGF2aW9yOiAnc21vb3RoJywKICAgICAgICAgICAgICAg
ICAgICBibG9jazogJ3N0YXJ0JwogICAgICAgICAgICAgICAgfSk7CiAgICAg
ICAgICAgIH0KICAgICAgICB9KTsKICAgIH0pOwp9CgovKiBJbml0aWFsaXpl
IHN0YXR1cyBtb25pdG9yaW5nICovCmZ1bmN0aW9uIGluaXRTdGF0dXMoKSB7
CiAgICAvLyBDcmVhdGUgc3RhdHVzIGluZGljYXRvcgogICAgY29uc3Qgc3Rh
dHVzRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGF0dXMn
KTsKICAgIGlmICghc3RhdHVzRWxlbWVudCkgcmV0dXJuOwogICAgCiAgICAv
LyBDaGVjayBpZiBzaXRlIGlzIHJ1bm5pbmcgcHJvcGVybHkKICAgIGxldCBp
c09ubGluZSA9IHRydWU7CiAgICAKICAgIC8vIFNpbXVsYXRlIHN0YXR1cyBj
aGVjayAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiwgeW91IG1pZ2h0IHBpbmcg
YW4gQVBJKQogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgdXBkYXRl
U3RhdHVzKGlzT25saW5lKTsKICAgIH0sIDIwMDApOwogICAgCiAgICAvLyBQ
ZXJpb2RpYyBzdGF0dXMgY2hlY2tzCiAgICBzZXRJbnRlcnZhbCgoKSA9PiB7
CiAgICAgICAgLy8gSGVyZSB5b3UgY291bGQgYWRkIHJlYWwgbW9uaXRvcmlu
ZwogICAgICAgIC8vIEZvciBub3csIGp1c3QgbWFpbnRhaW4gb25saW5lIHN0
YXR1cwogICAgICAgIHVwZGF0ZVN0YXR1cyhpc09ubGluZSk7CiAgICB9LCAz
MDAwMCk7IC8vIENoZWNrIGV2ZXJ5IDMwIHNlY29uZHMKfQoKLyogVXBkYXRl
IHN0YXR1cyBkaXNwbGF5ICovCmZ1bmN0aW9uIHVwZGF0ZVN0YXR1cyhpc09u
bGluZSkgewogICAgY29uc3Qgc3RhdHVzRWxlbWVudCA9IGRvY3VtZW50Lmdl
dEVsZW1lbnRCeUlkKCdzdGF0dXMnKTsKICAgIGlmICghc3RhdHVzRWxlbWVu
dCkgcmV0dXJuOwogICAgCiAgICBjb25zdCBzdGF0dXNTcGFuID0gc3RhdHVz
RWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuc3RhdHVzLW9ubGluZScpOwogICAg
aWYgKCFzdGF0dXNTcGFuKSByZXR1cm47CiAgICAKICAgIGlmIChpc09ubGlu
ZSkgewogICAgICAgIHN0YXR1c1NwYW4uaW5uZXJIVE1MID0gJ/Cfn6Ig0KHQ
sNC50YIg0LDQutGC0LjQstC10L0nOwogICAgICAgIHN0YXR1c0VsZW1lbnQu
c3R5bGUuYmFja2dyb3VuZCA9ICdyZ2JhKDAsIDI1NSwgMCwgMC4yKSc7CiAg
ICAgICAgc3RhdHVzRWxlbWVudC5zdHlsZS5ib3JkZXJDb2xvciA9ICdyZ2Jh
KDAsIDI1NSwgMCwgMC4zKSc7CiAgICB9IGVsc2UgewogICAgICAgIHN0YXR1
c1NwYW4uaW5uZXJIVE1MID0gJ/CflLQg0KHQsNC50YIg0L3QtdC00L7RgdGC
0YPQv9C10L0nOwogICAgICAgIHN0YXR1c0VsZW1lbnQuc3R5bGUuYmFja2dy
b3VuZCA9ICdyZ2JhKDI1NSwgMCwgMCwgMC4yKSc7CiAgICAgICAgc3RhdHVz
RWxlbWVudC5zdHlsZS5ib3JkZXJDb2xvciA9ICdyZ2JhKDI1NSwgMCwgMCwg
MC4zKSc7CiAgICB9Cn0KCi8qIENoZWNrIGVudmlyb25tZW50IGFuZCBmZWF0
dXJlcyAqLwpmdW5jdGlvbiBjaGVja0Vudmlyb25tZW50KCkgewogICAgY29u
c29sZS5sb2coJ/CflI0gRW52aXJvbm1lbnQgY2hlY2s6Jyk7CiAgICAKICAg
IC8vIENoZWNrIGlmIHJ1bm5pbmcgb24gTmV0bGlmeQogICAgY29uc3QgaXNO
ZXRsaWZ5ID0gd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lLmluY2x1ZGVzKCdu
ZXRsaWZ5LmFwcCcpIHx8IAogICAgICAgICAgICAgICAgICAgICAgd2luZG93
LmxvY2F0aW9uLmhvc3RuYW1lLmluY2x1ZGVzKCduZXRsaWZ5LmNvbScpOwog
ICAgY29uc29sZS5sb2coJ/CfjJAgUnVubmluZyBvbiBOZXRsaWZ5OicsIGlz
TmV0bGlmeSk7CiAgICAKICAgIC8vIENoZWNrIGlmIEhUVFBTIGlzIGVuYWJs
ZWQKICAgIGNvbnN0IGlzSFRUUFMgPSB3aW5kb3cubG9jYXRpb24ucHJvdG9j
b2wgPT09ICdodHRwczonOwogICAgY29uc29sZS5sb2coJ/CflJIgSFRUUFMg
ZW5hYmxlZDonLCBpc0hUVFBTKTsKICAgIAogICAgLy8gQ2hlY2sgdmlld3Bv
cnQKICAgIGNvbnN0IHZpZXdwb3J0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rv
cignbWV0YVtuYW1lPSJ2aWV3cG9ydCJdJyk7CiAgICBjb25zb2xlLmxvZygn
8J+TsSBNb2JpbGUgb3B0aW1pemVkOicsICEhdmlld3BvcnQpOwogICAgCiAg
ICAvLyBBZGQgZW52aXJvbm1lbnQgY2xhc3MgdG8gYm9keQogICAgZG9jdW1l
bnQuYm9keS5jbGFzc0xpc3QuYWRkKCduZXRsaWZ5LWVudicpOwogICAgCiAg
ICBpZiAoaXNOZXRsaWZ5KSB7CiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFz
c0xpc3QuYWRkKCdydW5uaW5nLW9uLW5ldGxpZnknKTsKICAgICAgICBjb25z
b2xlLmxvZygn4pyFIEZ1bGwgTmV0bGlmeSBpbnRlZ3JhdGlvbiBkZXRlY3Rl
ZCcpOwogICAgfQp9CgovKiBFcnJvciBoYW5kbGluZyAqLwp3aW5kb3cuYWRk
RXZlbnRMaXN0ZW5lcignZXJyb3InLCBmdW5jdGlvbihlKSB7CiAgICBjb25z
b2xlLmVycm9yKCfwn5qoIEphdmFTY3JpcHQgZXJyb3I6JywgZS5lcnJvcik7
Cn0pOwoKLyogUGVyZm9ybWFuY2UgbW9uaXRvcmluZyAqLwp3aW5kb3cuYWRk
RXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uKCkgewogICAgc2V0VGlt
ZW91dCgoKSA9PiB7CiAgICAgICAgY29uc3QgcGVyZkRhdGEgPSBwZXJmb3Jt
YW5jZS5nZXRFbnRyaWVzQnlUeXBlKCduYXZpZ2F0aW9uJylbMF07CiAgICAg
ICAgaWYgKHBlcmZEYXRhKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfi
mqEgTG9hZCB0aW1lOicsIE1hdGgucm91bmQocGVyZkRhdGEubG9hZEV2ZW50
RW5kIC0gcGVyZkRhdGEubG9hZEV2ZW50U3RhcnQpLCAnbXMnKTsKICAgICAg
ICB9CiAgICB9LCAwKTsKfSk7
